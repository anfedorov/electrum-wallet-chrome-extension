/**
 * BitcoinJS-lib v0.1.0-default
 * Copyright (c) 2011 BitcoinJS Project
 * 
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the MIT license.
 */
(function(){var base64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Crypto=window.Crypto={},util=Crypto.util={rotl:function(n,b){return n<<b|n>>>32-b},rotr:function(n,b){return n<<32-b|n>>>b},endian:function(n){if(n.constructor==Number)return util.rotl(n,8)&16711935|util.rotl(n,24)&4278255360;for(var i=0;i<n.length;i++)n[i]=util.endian(n[i]);return n},randomBytes:function(n){var bytes=new Uint8Array(n),bs;crypto.getRandomValues(bytes);for(var bs=[];n>0;n--)bs.push(bytes[n-1]);return bs},bytesToWords:function(bytes){for(var words=[],i=0,b=0;i<bytes.length;i++,b+=8)words[b>>>5]|=bytes[i]<<24-b%32;return words},wordsToBytes:function(words){for(var bytes=[],b=0;b<words.length*32;b+=8)bytes.push(words[b>>>5]>>>24-b%32&255);return bytes},bytesToHex:function(bytes){for(var hex=[],i=0;i<bytes.length;i++)hex.push((bytes[i]>>>4).toString(16)),hex.push((bytes[i]&15).toString(16));return hex.join("")},hexToBytes:function(hex){for(var bytes=[],c=0;c<hex.length;c+=2)bytes.push(parseInt(hex.substr(c,2),16));return bytes},bytesToBase64:function(bytes){if(typeof btoa=="function")return btoa(Binary.bytesToString(bytes));for(var base64=[],i=0;i<bytes.length;i+=3){var triplet=bytes[i]<<16|bytes[i+1]<<8|bytes[i+2];for(var j=0;j<4;j++)i*8+j*6<=bytes.length*8?base64.push(base64map.charAt(triplet>>>6*(3-j)&63)):base64.push("=")}return base64.join("")},base64ToBytes:function(base64){if(typeof atob=="function")return Binary.stringToBytes(atob(base64));base64=base64.replace(/[^A-Z0-9+\/]/ig,"");for(var bytes=[],i=0,imod4=0;i<base64.length;imod4=++i%4){if(imod4==0)continue;bytes.push((base64map.indexOf(base64.charAt(i-1))&Math.pow(2,-2*imod4+8)-1)<<imod4*2|base64map.indexOf(base64.charAt(i))>>>6-imod4*2)}return bytes}};Crypto.mode={};var charenc=Crypto.charenc={},UTF8=charenc.UTF8={stringToBytes:function(str){return Binary.stringToBytes(unescape(encodeURIComponent(str)))},bytesToString:function(bytes){return decodeURIComponent(escape(Binary.bytesToString(bytes)))}},Binary=charenc.Binary={stringToBytes:function(str){for(var bytes=[],i=0;i<str.length;i++)bytes.push(str.charCodeAt(i));return bytes},bytesToString:function(bytes){for(var str=[],i=0;i<bytes.length;i++)str.push(String.fromCharCode(bytes[i]));return str.join("")}}})();
(function(){var C=Crypto,util=C.util,charenc=C.charenc,UTF8=charenc.UTF8,Binary=charenc.Binary,K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],SHA256=C.SHA256=function(message,options){var digestbytes=util.wordsToBytes(SHA256._sha256(message));return options&&options.asBytes?digestbytes:options&&options.asString?Binary.bytesToString(digestbytes):util.bytesToHex(digestbytes)};SHA256._sha256=function(message){message.constructor==String&&(message=UTF8.stringToBytes(message));var m=util.bytesToWords(message),l=message.length*8,H=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],w=[],a,b,c,d,e,f,g,h,i,j,t1,t2;m[l>>5]|=128<<24-l%32,m[(l+64>>9<<4)+15]=l;for(var i=0;i<m.length;i+=16){a=H[0],b=H[1],c=H[2],d=H[3],e=H[4],f=H[5],g=H[6],h=H[7];for(var j=0;j<64;j++){if(j<16)w[j]=m[j+i];else{var gamma0x=w[j-15],gamma1x=w[j-2],gamma0=(gamma0x<<25|gamma0x>>>7)^(gamma0x<<14|gamma0x>>>18)^gamma0x>>>3,gamma1=(gamma1x<<15|gamma1x>>>17)^(gamma1x<<13|gamma1x>>>19)^gamma1x>>>10;w[j]=gamma0+(w[j-7]>>>0)+gamma1+(w[j-16]>>>0)}var ch=e&f^~e&g,maj=a&b^a&c^b&c,sigma0=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),sigma1=(e<<26|e>>>6)^(e<<21|e>>>11)^(e<<7|e>>>25);t1=(h>>>0)+sigma1+ch+K[j]+(w[j]>>>0),t2=sigma0+maj,h=g,g=f,f=e,e=d+t1,d=c,c=b,b=a,a=t1+t2}H[0]+=a,H[1]+=b,H[2]+=c,H[3]+=d,H[4]+=e,H[5]+=f,H[6]+=g,H[7]+=h}return H},SHA256._blocksize=16})();
(function(){function rmd160_f(j,x,y,z){return 0<=j&&j<=15?x^y^z:16<=j&&j<=31?x&y|~x&z:32<=j&&j<=47?(x|~y)^z:48<=j&&j<=63?x&z|y&~z:64<=j&&j<=79?x^(y|~z):"rmd160_f: j out of range"}function rmd160_K1(j){return 0<=j&&j<=15?0:16<=j&&j<=31?1518500249:32<=j&&j<=47?1859775393:48<=j&&j<=63?2400959708:64<=j&&j<=79?2840853838:"rmd160_K1: j out of range"}function rmd160_K2(j){return 0<=j&&j<=15?1352829926:16<=j&&j<=31?1548603684:32<=j&&j<=47?1836072691:48<=j&&j<=63?2053994217:64<=j&&j<=79?0:"rmd160_K2: j out of range"}function safe_add(x,y){var lsw=(x&65535)+(y&65535),msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}var C=Crypto,util=C.util,charenc=C.charenc,UTF8=charenc.UTF8,Binary=charenc.Binary;util.bytesToLWords=function(bytes){var output=Array(bytes.length>>2);for(var i=0;i<output.length;i++)output[i]=0;for(var i=0;i<bytes.length*8;i+=8)output[i>>5]|=(bytes[i/8]&255)<<i%32;return output},util.lWordsToBytes=function(words){var output=[];for(var i=0;i<words.length*32;i+=8)output.push(words[i>>5]>>>i%32&255);return output};var RIPEMD160=C.RIPEMD160=function(message,options){var digestbytes=util.lWordsToBytes(RIPEMD160._rmd160(message));return options&&options.asBytes?digestbytes:options&&options.asString?Binary.bytesToString(digestbytes):util.bytesToHex(digestbytes)};RIPEMD160._rmd160=function(message){message.constructor==String&&(message=UTF8.stringToBytes(message));var x=util.bytesToLWords(message),len=message.length*8;x[len>>5]|=128<<len%32,x[(len+64>>>9<<4)+14]=len;var h0=1732584193,h1=4023233417,h2=2562383102,h3=271733878,h4=3285377520;for(var i=0;i<x.length;i+=16){var T,A1=h0,B1=h1,C1=h2,D1=h3,E1=h4,A2=h0,B2=h1,C2=h2,D2=h3,E2=h4;for(var j=0;j<=79;++j)T=safe_add(A1,rmd160_f(j,B1,C1,D1)),T=safe_add(T,x[i+rmd160_r1[j]]),T=safe_add(T,rmd160_K1(j)),T=safe_add(bit_rol(T,rmd160_s1[j]),E1),A1=E1,E1=D1,D1=bit_rol(C1,10),C1=B1,B1=T,T=safe_add(A2,rmd160_f(79-j,B2,C2,D2)),T=safe_add(T,x[i+rmd160_r2[j]]),T=safe_add(T,rmd160_K2(j)),T=safe_add(bit_rol(T,rmd160_s2[j]),E2),A2=E2,E2=D2,D2=bit_rol(C2,10),C2=B2,B2=T;T=safe_add(h1,safe_add(C1,D2)),h1=safe_add(h2,safe_add(D1,E2)),h2=safe_add(h3,safe_add(E1,A2)),h3=safe_add(h4,safe_add(A1,B2)),h4=safe_add(h0,safe_add(B1,C2)),h0=T}return[h0,h1,h2,h3,h4]};var rmd160_r1=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],rmd160_r2=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],rmd160_s1=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],rmd160_s2=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]})();
function Arcfour(){this.i=0,this.j=0,this.S=new Array}function ARC4init(key){var i,j,t;for(i=0;i<256;++i)this.S[i]=i;j=0;for(i=0;i<256;++i)j=j+this.S[i]+key[i%key.length]&255,t=this.S[i],this.S[i]=this.S[j],this.S[j]=t;this.i=0,this.j=0}function ARC4next(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]}function prng_newstate(){return new Arcfour}Arcfour.prototype.init=ARC4init,Arcfour.prototype.next=ARC4next;var rng_psize=256;
function rng_seed_int(x){rng_pool[rng_pptr++]^=x&255,rng_pool[rng_pptr++]^=x>>8&255,rng_pool[rng_pptr++]^=x>>16&255,rng_pool[rng_pptr++]^=x>>24&255,rng_pptr>=rng_psize&&(rng_pptr-=rng_psize)}function rng_seed_time(){rng_seed_int((new Date).getTime())}function rng_get_byte(){if(rng_state==null){rng_seed_time(),rng_state=prng_newstate(),rng_state.init(rng_pool);for(rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr)rng_pool[rng_pptr]=0;rng_pptr=0}return rng_state.next()}function rng_get_bytes(ba){var i;for(i=0;i<ba.length;++i)ba[i]=rng_get_byte()}function SecureRandom(){}var rng_state,rng_pool,rng_pptr;if(rng_pool==null){rng_pool=new Array,rng_pptr=0;var t;if(navigator.appName=="Netscape"&&navigator.appVersion<"5"&&window.crypto){var z=window.crypto.random(32);for(t=0;t<z.length;++t)rng_pool[rng_pptr++]=z.charCodeAt(t)&255}while(rng_pptr<rng_psize)t=Math.floor(65536*Math.random()),rng_pool[rng_pptr++]=t>>>8,rng_pool[rng_pptr++]=t&255;rng_pptr=0,rng_seed_time()}SecureRandom.prototype.nextBytes=rng_get_bytes;
function BigInteger(a,b,c){a!=null&&("number"==typeof a?this.fromNumber(a,b,c):b==null&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function nbi(){return new BigInteger(null)}function am1(i,x,w,j,c,n){while(--n>=0){var v=x*this[i++]+w[j]+c;c=Math.floor(v/67108864),w[j++]=v&67108863}return c}function am2(i,x,w,j,c,n){var xl=x&32767,xh=x>>15;while(--n>=0){var l=this[i]&32767,h=this[i++]>>15,m=xh*l+h*xl;l=xl*l+((m&32767)<<15)+w[j]+(c&1073741823),c=(l>>>30)+(m>>>15)+xh*h+(c>>>30),w[j++]=l&1073741823}return c}function am3(i,x,w,j,c,n){var xl=x&16383,xh=x>>14;while(--n>=0){var l=this[i]&16383,h=this[i++]>>14,m=xh*l+h*xl;l=xl*l+((m&16383)<<14)+w[j]+c,c=(l>>28)+(m>>14)+xh*h,w[j++]=l&268435455}return c}function int2char(n){return BI_RM.charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return c==null?-1:c}function bnpCopyTo(r){for(var i=this.t-1;i>=0;--i)r[i]=this[i];r.t=this.t,r.s=this.s}function bnpFromInt(x){this.t=1,this.s=x<0?-1:0,x>0?this[0]=x:x<-1?this[0]=x+DV:this.t=0}function nbv(i){var r=nbi();return r.fromInt(i),r}function bnpFromString(s,b){var k;if(b==16)k=4;else if(b==8)k=3;else if(b==256)k=8;else if(b==2)k=1;else if(b==32)k=5;else{if(b!=4){this.fromRadix(s,b);return}k=2}this.t=0,this.s=0;var i=s.length,mi=!1,sh=0;while(--i>=0){var x=k==8?s[i]&255:intAt(s,i);if(x<0){s.charAt(i)=="-"&&(mi=!0);continue}mi=!1,sh==0?this[this.t++]=x:sh+k>this.DB?(this[this.t-1]|=(x&(1<<this.DB-sh)-1)<<sh,this[this.t++]=x>>this.DB-sh):this[this.t-1]|=x<<sh,sh+=k,sh>=this.DB&&(sh-=this.DB)}k==8&&(s[0]&128)!=0&&(this.s=-1,sh>0&&(this[this.t-1]|=(1<<this.DB-sh)-1<<sh)),this.clamp(),mi&&BigInteger.ZERO.subTo(this,this)}function bnpClamp(){var c=this.s&this.DM;while(this.t>0&&this[this.t-1]==c)--this.t}function bnToString(b){if(this.s<0)return"-"+this.negate().toString(b);var k;if(b==16)k=4;else if(b==8)k=3;else if(b==2)k=1;else if(b==32)k=5;else{if(b!=4)return this.toRadix(b);k=2}var km=(1<<k)-1,d,m=!1,r="",i=this.t,p=this.DB-i*this.DB%k;if(i-->0){p<this.DB&&(d=this[i]>>p)>0&&(m=!0,r=int2char(d));while(i>=0)p<k?(d=(this[i]&(1<<p)-1)<<k-p,d|=this[--i]>>(p+=this.DB-k)):(d=this[i]>>(p-=k)&km,p<=0&&(p+=this.DB,--i)),d>0&&(m=!0),m&&(r+=int2char(d))}return m?r:"0"}function bnNegate(){var r=nbi();return BigInteger.ZERO.subTo(this,r),r}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(a){var r=this.s-a.s;if(r!=0)return r;var i=this.t;r=i-a.t;if(r!=0)return r;while(--i>=0)if((r=this[i]-a[i])!=0)return r;return 0}function nbits(x){var r=1,t;return(t=x>>>16)!=0&&(x=t,r+=16),(t=x>>8)!=0&&(x=t,r+=8),(t=x>>4)!=0&&(x=t,r+=4),(t=x>>2)!=0&&(x=t,r+=2),(t=x>>1)!=0&&(x=t,r+=1),r}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(n,r){var i;for(i=this.t-1;i>=0;--i)r[i+n]=this[i];for(i=n-1;i>=0;--i)r[i]=0;r.t=this.t+n,r.s=this.s}function bnpDRShiftTo(n,r){for(var i=n;i<this.t;++i)r[i-n]=this[i];r.t=Math.max(this.t-n,0),r.s=this.s}function bnpLShiftTo(n,r){var bs=n%this.DB,cbs=this.DB-bs,bm=(1<<cbs)-1,ds=Math.floor(n/this.DB),c=this.s<<bs&this.DM,i;for(i=this.t-1;i>=0;--i)r[i+ds+1]=this[i]>>cbs|c,c=(this[i]&bm)<<bs;for(i=ds-1;i>=0;--i)r[i]=0;r[ds]=c,r.t=this.t+ds+1,r.s=this.s,r.clamp()}function bnpRShiftTo(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t){r.t=0;return}var bs=n%this.DB,cbs=this.DB-bs,bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i)r[i-ds-1]|=(this[i]&bm)<<cbs,r[i-ds]=this[i]>>bs;bs>0&&(r[this.t-ds-1]|=(this.s&bm)<<cbs),r.t=this.t-ds,r.clamp()}function bnpSubTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m)c+=this[i]-a[i],r[i++]=c&this.DM,c>>=this.DB;if(a.t<this.t){c-=a.s;while(i<this.t)c+=this[i],r[i++]=c&this.DM,c>>=this.DB;c+=this.s}else{c+=this.s;while(i<a.t)c-=a[i],r[i++]=c&this.DM,c>>=this.DB;c-=a.s}r.s=c<0?-1:0,c<-1?r[i++]=this.DV+c:c>0&&(r[i++]=c),r.t=i,r.clamp()}function bnpMultiplyTo(a,r){var x=this.abs(),y=a.abs(),i=x.t;r.t=i+y.t;while(--i>=0)r[i]=0;for(i=0;i<y.t;++i)r[i+x.t]=x.am(0,y[i],r,i,0,x.t);r.s=0,r.clamp(),this.s!=a.s&&BigInteger.ZERO.subTo(r,r)}function bnpSquareTo(r){var x=this.abs(),i=r.t=2*x.t;while(--i>=0)r[i]=0;for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);(r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV&&(r[i+x.t]-=x.DV,r[i+x.t+1]=1)}r.t>0&&(r[r.t-1]+=x.am(i,x[i],r,2*i,0,1)),r.s=0,r.clamp()}function bnpDivRemTo(m,q,r){var pm=m.abs();if(pm.t<=0)return;var pt=this.abs();if(pt.t<pm.t){q!=null&&q.fromInt(0),r!=null&&this.copyTo(r);return}r==null&&(r=nbi());var y=nbi(),ts=this.s,ms=m.s,nsh=this.DB-nbits(pm[pm.t-1]);nsh>0?(pm.lShiftTo(nsh,y),pt.lShiftTo(nsh,r)):(pm.copyTo(y),pt.copyTo(r));var ys=y.t,y0=y[ys-1];if(y0==0)return;var yt=y0*(1<<this.F1)+(ys>1?y[ys-2]>>this.F2:0),d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2,i=r.t,j=i-ys,t=q==null?nbi():q;y.dlShiftTo(j,t),r.compareTo(t)>=0&&(r[r.t++]=1,r.subTo(t,r)),BigInteger.ONE.dlShiftTo(ys,t),t.subTo(y,y);while(y.t<ys)y[y.t++]=0;while(--j>=0){var qd=r[--i]==y0?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd){y.dlShiftTo(j,t),r.subTo(t,r);while(r[i]<--qd)r.subTo(t,r)}}q!=null&&(r.drShiftTo(ys,q),ts!=ms&&BigInteger.ZERO.subTo(q,q)),r.t=ys,r.clamp(),nsh>0&&r.rShiftTo(nsh,r),ts<0&&BigInteger.ZERO.subTo(r,r)}function bnMod(a){var r=nbi();return this.abs().divRemTo(a,null,r),this.s<0&&r.compareTo(BigInteger.ZERO)>0&&a.subTo(r,r),r}function Classic(m){this.m=m}function cConvert(x){return x.s<0||x.compareTo(this.m)>=0?x.mod(this.m):x}function cRevert(x){return x}function cReduce(x){x.divRemTo(this.m,null,x)}function cMulTo(x,y,r){x.multiplyTo(y,r),this.reduce(r)}function cSqrTo(x,r){x.squareTo(r),this.reduce(r)}function bnpInvDigit(){if(this.t<1)return 0;var x=this[0];if((x&1)==0)return 0;var y=x&3;return y=y*(2-(x&15)*y)&15,y=y*(2-(x&255)*y)&255,y=y*(2-((x&65535)*y&65535))&65535,y=y*(2-x*y%this.DV)%this.DV,y>0?this.DV-y:-y}function Montgomery(m){this.m=m,this.mp=m.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<m.DB-15)-1,this.mt2=2*m.t}function montConvert(x){var r=nbi();return x.abs().dlShiftTo(this.m.t,r),r.divRemTo(this.m,null,r),x.s<0&&r.compareTo(BigInteger.ZERO)>0&&this.m.subTo(r,r),r}function montRevert(x){var r=nbi();return x.copyTo(r),this.reduce(r),r}function montReduce(x){while(x.t<=this.mt2)x[x.t++]=0;for(var i=0;i<this.m.t;++i){var j=x[i]&32767,u0=j*this.mpl+((j*this.mph+(x[i]>>15)*this.mpl&this.um)<<15)&x.DM;j=i+this.m.t,x[j]+=this.m.am(0,u0,x,i,0,this.m.t);while(x[j]>=x.DV)x[j]-=x.DV,x[++j]++}x.clamp(),x.drShiftTo(this.m.t,x),x.compareTo(this.m)>=0&&x.subTo(this.m,x)}function montSqrTo(x,r){x.squareTo(r),this.reduce(r)}function montMulTo(x,y,r){x.multiplyTo(y,r),this.reduce(r)}function bnpIsEven(){return(this.t>0?this[0]&1:this.s)==0}function bnpExp(e,z){if(e>4294967295||e<1)return BigInteger.ONE;var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;g.copyTo(r);while(--i>=0){z.sqrTo(r,r2);if((e&1<<i)>0)z.mulTo(r2,g,r);else{var t=r;r=r2,r2=t}}return z.revert(r)}function bnModPowInt(e,m){var z;return e<256||m.isEven()?z=new Classic(m):z=new Montgomery(m),this.exp(e,z)}var dbits,canary=0xdeadbeefcafe,j_lm=(canary&16777215)==15715070;j_lm&&navigator.appName=="Microsoft Internet Explorer"?(BigInteger.prototype.am=am2,dbits=30):j_lm&&navigator.appName!="Netscape"?(BigInteger.prototype.am=am1,dbits=26):(BigInteger.prototype.am=am3,dbits=28),BigInteger.prototype.DB=dbits,BigInteger.prototype.DM=(1<<dbits)-1,BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP),BigInteger.prototype.F1=BI_FP-dbits,BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array,rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr="a".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr="A".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;Classic.prototype.convert=cConvert,Classic.prototype.revert=cRevert,Classic.prototype.reduce=cReduce,Classic.prototype.mulTo=cMulTo,Classic.prototype.sqrTo=cSqrTo,Montgomery.prototype.convert=montConvert,Montgomery.prototype.revert=montRevert,Montgomery.prototype.reduce=montReduce,Montgomery.prototype.mulTo=montMulTo,Montgomery.prototype.sqrTo=montSqrTo,BigInteger.prototype.copyTo=bnpCopyTo,BigInteger.prototype.fromInt=bnpFromInt,BigInteger.prototype.fromString=bnpFromString,BigInteger.prototype.clamp=bnpClamp,BigInteger.prototype.dlShiftTo=bnpDLShiftTo,BigInteger.prototype.drShiftTo=bnpDRShiftTo,BigInteger.prototype.lShiftTo=bnpLShiftTo,BigInteger.prototype.rShiftTo=bnpRShiftTo,BigInteger.prototype.subTo=bnpSubTo,BigInteger.prototype.multiplyTo=bnpMultiplyTo,BigInteger.prototype.squareTo=bnpSquareTo,BigInteger.prototype.divRemTo=bnpDivRemTo,BigInteger.prototype.invDigit=bnpInvDigit,BigInteger.prototype.isEven=bnpIsEven,BigInteger.prototype.exp=bnpExp,BigInteger.prototype.toString=bnToString,BigInteger.prototype.negate=bnNegate,BigInteger.prototype.abs=bnAbs,BigInteger.prototype.compareTo=bnCompareTo,BigInteger.prototype.bitLength=bnBitLength,BigInteger.prototype.mod=bnMod,BigInteger.prototype.modPowInt=bnModPowInt,BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1);
function bnClone(){var r=nbi();return this.copyTo(r),r}function bnIntValue(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return this.t==0?this.s:this[0]<<24>>24}function bnShortValue(){return this.t==0?this.s:this[0]<<16>>16}function bnpChunkSize(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function bnSigNum(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function bnpToRadix(b){b==null&&(b=10);if(this.signum()==0||b<2||b>36)return"0";var cs=this.chunkSize(b),a=Math.pow(b,cs),d=nbv(a),y=nbi(),z=nbi(),r="";this.divRemTo(d,y,z);while(y.signum()>0)r=(a+z.intValue()).toString(b).substr(1)+r,y.divRemTo(d,y,z);return z.intValue().toString(b)+r}function bnpFromRadix(s,b){this.fromInt(0),b==null&&(b=10);var cs=this.chunkSize(b),d=Math.pow(b,cs),mi=!1,j=0,w=0;for(var i=0;i<s.length;++i){var x=intAt(s,i);if(x<0){s.charAt(i)=="-"&&this.signum()==0&&(mi=!0);continue}w=b*w+x,++j>=cs&&(this.dMultiply(d),this.dAddOffset(w,0),j=0,w=0)}j>0&&(this.dMultiply(Math.pow(b,j)),this.dAddOffset(w,0)),mi&&BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(a,b,c){if("number"==typeof b)if(a<2)this.fromInt(1);else{this.fromNumber(a,c),this.testBit(a-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(a-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);while(!this.isProbablePrime(b))this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(BigInteger.ONE.shiftLeft(a-1),this)}else{var x=new Array,t=a&7;x.length=(a>>3)+1,b.nextBytes(x),t>0?x[0]&=(1<<t)-1:x[0]=0,this.fromString(x,256)}}function bnToByteArray(){var i=this.t,r=new Array;r[0]=this.s;var p=this.DB-i*this.DB%8,d,k=0;if(i-->0){p<this.DB&&(d=this[i]>>p)!=(this.s&this.DM)>>p&&(r[k++]=d|this.s<<this.DB-p);while(i>=0){p<8?(d=(this[i]&(1<<p)-1)<<8-p,d|=this[--i]>>(p+=this.DB-8)):(d=this[i]>>(p-=8)&255,p<=0&&(p+=this.DB,--i)),(d&128)!=0&&(d|=-256),k==0&&(this.s&128)!=(d&128)&&++k;if(k>0||d!=this.s)r[k++]=d}}return r}function bnEquals(a){return this.compareTo(a)==0}function bnMin(a){return this.compareTo(a)<0?this:a}function bnMax(a){return this.compareTo(a)>0?this:a}function bnpBitwiseTo(a,op,r){var i,f,m=Math.min(a.t,this.t);for(i=0;i<m;++i)r[i]=op(this[i],a[i]);if(a.t<this.t){f=a.s&this.DM;for(i=m;i<this.t;++i)r[i]=op(this[i],f);r.t=this.t}else{f=this.s&this.DM;for(i=m;i<a.t;++i)r[i]=op(f,a[i]);r.t=a.t}r.s=op(this.s,a.s),r.clamp()}function op_and(x,y){return x&y}function bnAnd(a){var r=nbi();return this.bitwiseTo(a,op_and,r),r}function op_or(x,y){return x|y}function bnOr(a){var r=nbi();return this.bitwiseTo(a,op_or,r),r}function op_xor(x,y){return x^y}function bnXor(a){var r=nbi();return this.bitwiseTo(a,op_xor,r),r}function op_andnot(x,y){return x&~y}function bnAndNot(a){var r=nbi();return this.bitwiseTo(a,op_andnot,r),r}function bnNot(){var r=nbi();for(var i=0;i<this.t;++i)r[i]=this.DM&~this[i];return r.t=this.t,r.s=~this.s,r}function bnShiftLeft(n){var r=nbi();return n<0?this.rShiftTo(-n,r):this.lShiftTo(n,r),r}function bnShiftRight(n){var r=nbi();return n<0?this.lShiftTo(-n,r):this.rShiftTo(n,r),r}function lbit(x){if(x==0)return-1;var r=0;return(x&65535)==0&&(x>>=16,r+=16),(x&255)==0&&(x>>=8,r+=8),(x&15)==0&&(x>>=4,r+=4),(x&3)==0&&(x>>=2,r+=2),(x&1)==0&&++r,r}function bnGetLowestSetBit(){for(var i=0;i<this.t;++i)if(this[i]!=0)return i*this.DB+lbit(this[i]);return this.s<0?this.t*this.DB:-1}function cbit(x){var r=0;while(x!=0)x&=x-1,++r;return r}function bnBitCount(){var r=0,x=this.s&this.DM;for(var i=0;i<this.t;++i)r+=cbit(this[i]^x);return r}function bnTestBit(n){var j=Math.floor(n/this.DB);return j>=this.t?this.s!=0:(this[j]&1<<n%this.DB)!=0}function bnpChangeBit(n,op){var r=BigInteger.ONE.shiftLeft(n);return this.bitwiseTo(r,op,r),r}function bnSetBit(n){return this.changeBit(n,op_or)}function bnClearBit(n){return this.changeBit(n,op_andnot)}function bnFlipBit(n){return this.changeBit(n,op_xor)}function bnpAddTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m)c+=this[i]+a[i],r[i++]=c&this.DM,c>>=this.DB;if(a.t<this.t){c+=a.s;while(i<this.t)c+=this[i],r[i++]=c&this.DM,c>>=this.DB;c+=this.s}else{c+=this.s;while(i<a.t)c+=a[i],r[i++]=c&this.DM,c>>=this.DB;c+=a.s}r.s=c<0?-1:0,c>0?r[i++]=c:c<-1&&(r[i++]=this.DV+c),r.t=i,r.clamp()}function bnAdd(a){var r=nbi();return this.addTo(a,r),r}function bnSubtract(a){var r=nbi();return this.subTo(a,r),r}function bnMultiply(a){var r=nbi();return this.multiplyTo(a,r),r}function bnSquare(){var r=nbi();return this.squareTo(r),r}function bnDivide(a){var r=nbi();return this.divRemTo(a,r,null),r}function bnRemainder(a){var r=nbi();return this.divRemTo(a,null,r),r}function bnDivideAndRemainder(a){var q=nbi(),r=nbi();return this.divRemTo(a,q,r),new Array(q,r)}function bnpDMultiply(n){this[this.t]=this.am(0,n-1,this,0,0,this.t),++this.t,this.clamp()}function bnpDAddOffset(n,w){if(n==0)return;while(this.t<=w)this[this.t++]=0;this[w]+=n;while(this[w]>=this.DV)this[w]-=this.DV,++w>=this.t&&(this[this.t++]=0),++this[w]}function NullExp(){}function nNop(x){return x}function nMulTo(x,y,r){x.multiplyTo(y,r)}function nSqrTo(x,r){x.squareTo(r)}function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(a,n,r){var i=Math.min(this.t+a.t,n);r.s=0,r.t=i;while(i>0)r[--i]=0;var j;for(j=r.t-this.t;i<j;++i)r[i+this.t]=this.am(0,a[i],r,i,0,this.t);for(j=Math.min(a.t,n);i<j;++i)this.am(0,a[i],r,i,0,n-i);r.clamp()}function bnpMultiplyUpperTo(a,n,r){--n;var i=r.t=this.t+a.t-n;r.s=0;while(--i>=0)r[i]=0;for(i=Math.max(n-this.t,0);i<a.t;++i)r[this.t+i-n]=this.am(n-i,a[i],r,0,0,this.t+i-n);r.clamp(),r.drShiftTo(1,r)}function Barrett(m){this.r2=nbi(),this.q3=nbi(),BigInteger.ONE.dlShiftTo(2*m.t,this.r2),this.mu=this.r2.divide(m),this.m=m}function barrettConvert(x){if(x.s<0||x.t>2*this.m.t)return x.mod(this.m);if(x.compareTo(this.m)<0)return x;var r=nbi();return x.copyTo(r),this.reduce(r),r}function barrettRevert(x){return x}function barrettReduce(x){x.drShiftTo(this.m.t-1,this.r2),x.t>this.m.t+1&&(x.t=this.m.t+1,x.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(x.compareTo(this.r2)<0)x.dAddOffset(1,this.m.t+1);x.subTo(this.r2,x);while(x.compareTo(this.m)>=0)x.subTo(this.m,x)}function barrettSqrTo(x,r){x.squareTo(r),this.reduce(r)}function barrettMulTo(x,y,r){x.multiplyTo(y,r),this.reduce(r)}function bnModPow(e,m){var i=e.bitLength(),k,r=nbv(1),z;if(i<=0)return r;i<18?k=1:i<48?k=3:i<144?k=4:i<768?k=5:k=6,i<8?z=new Classic(m):m.isEven()?z=new Barrett(m):z=new Montgomery(m);var g=new Array,n=3,k1=k-1,km=(1<<k)-1;g[1]=z.convert(this);if(k>1){var g2=nbi();z.sqrTo(g[1],g2);while(n<=km)g[n]=nbi(),z.mulTo(g2,g[n-2],g[n]),n+=2}var j=e.t-1,w,is1=!0,r2=nbi(),t;i=nbits(e[j])-1;while(j>=0){i>=k1?w=e[j]>>i-k1&km:(w=(e[j]&(1<<i+1)-1)<<k1-i,j>0&&(w|=e[j-1]>>this.DB+i-k1)),n=k;while((w&1)==0)w>>=1,--n;(i-=n)<0&&(i+=this.DB,--j);if(is1)g[w].copyTo(r),is1=!1;else{while(n>1)z.sqrTo(r,r2),z.sqrTo(r2,r),n-=2;n>0?z.sqrTo(r,r2):(t=r,r=r2,r2=t),z.mulTo(r2,g[w],r)}while(j>=0&&(e[j]&1<<i)==0)z.sqrTo(r,r2),t=r,r=r2,r2=t,--i<0&&(i=this.DB-1,--j)}return z.revert(r)}function bnGCD(a){var x=this.s<0?this.negate():this.clone(),y=a.s<0?a.negate():a.clone();if(x.compareTo(y)<0){var t=x;x=y,y=t}var i=x.getLowestSetBit(),g=y.getLowestSetBit();if(g<0)return x;i<g&&(g=i),g>0&&(x.rShiftTo(g,x),y.rShiftTo(g,y));while(x.signum()>0)(i=x.getLowestSetBit())>0&&x.rShiftTo(i,x),(i=y.getLowestSetBit())>0&&y.rShiftTo(i,y),x.compareTo(y)>=0?(x.subTo(y,x),x.rShiftTo(1,x)):(y.subTo(x,y),y.rShiftTo(1,y));return g>0&&y.lShiftTo(g,y),y}function bnpModInt(n){if(n<=0)return 0;var d=this.DV%n,r=this.s<0?n-1:0;if(this.t>0)if(d==0)r=this[0]%n;else for(var i=this.t-1;i>=0;--i)r=(d*r+this[i])%n;return r}function bnModInverse(m){var ac=m.isEven();if(this.isEven()&&ac||m.signum()==0)return BigInteger.ZERO;var u=m.clone(),v=this.clone(),a=nbv(1),b=nbv(0),c=nbv(0),d=nbv(1);while(u.signum()!=0){while(u.isEven()){u.rShiftTo(1,u);if(ac){if(!a.isEven()||!b.isEven())a.addTo(this,a),b.subTo(m,b);a.rShiftTo(1,a)}else b.isEven()||b.subTo(m,b);b.rShiftTo(1,b)}while(v.isEven()){v.rShiftTo(1,v);if(ac){if(!c.isEven()||!d.isEven())c.addTo(this,c),d.subTo(m,d);c.rShiftTo(1,c)}else d.isEven()||d.subTo(m,d);d.rShiftTo(1,d)}u.compareTo(v)>=0?(u.subTo(v,u),ac&&a.subTo(c,a),b.subTo(d,b)):(v.subTo(u,v),ac&&c.subTo(a,c),d.subTo(b,d))}return v.compareTo(BigInteger.ONE)!=0?BigInteger.ZERO:d.compareTo(m)>=0?d.subtract(m):d.signum()<0?(d.addTo(m,d),d.signum()<0?d.add(m):d):d}function bnIsProbablePrime(t){var i,x=this.abs();if(x.t==1&&x[0]<=lowprimes[lowprimes.length-1]){for(i=0;i<lowprimes.length;++i)if(x[0]==lowprimes[i])return!0;return!1}if(x.isEven())return!1;i=1;while(i<lowprimes.length){var m=lowprimes[i],j=i+1;while(j<lowprimes.length&&m<lplim)m*=lowprimes[j++];m=x.modInt(m);while(i<j)if(m%lowprimes[i++]==0)return!1}return x.millerRabin(t)}function bnpMillerRabin(t){var n1=this.subtract(BigInteger.ONE),k=n1.getLowestSetBit();if(k<=0)return!1;var r=n1.shiftRight(k);t=t+1>>1,t>lowprimes.length&&(t=lowprimes.length);var a=nbi();for(var i=0;i<t;++i){a.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var y=a.modPow(r,this);if(y.compareTo(BigInteger.ONE)!=0&&y.compareTo(n1)!=0){var j=1;while(j++<k&&y.compareTo(n1)!=0){y=y.modPowInt(2,this);if(y.compareTo(BigInteger.ONE)==0)return!1}if(y.compareTo(n1)!=0)return!1}}return!0}NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=nMulTo,NullExp.prototype.sqrTo=nSqrTo,Barrett.prototype.convert=barrettConvert,Barrett.prototype.revert=barrettRevert,Barrett.prototype.reduce=barrettReduce,Barrett.prototype.mulTo=barrettMulTo,Barrett.prototype.sqrTo=barrettSqrTo;var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lplim=(1<<26)/lowprimes[lowprimes.length-1];BigInteger.prototype.chunkSize=bnpChunkSize,BigInteger.prototype.toRadix=bnpToRadix,BigInteger.prototype.fromRadix=bnpFromRadix,BigInteger.prototype.fromNumber=bnpFromNumber,BigInteger.prototype.bitwiseTo=bnpBitwiseTo,BigInteger.prototype.changeBit=bnpChangeBit,BigInteger.prototype.addTo=bnpAddTo,BigInteger.prototype.dMultiply=bnpDMultiply,BigInteger.prototype.dAddOffset=bnpDAddOffset,BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo,BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo,BigInteger.prototype.modInt=bnpModInt,BigInteger.prototype.millerRabin=bnpMillerRabin,BigInteger.prototype.clone=bnClone,BigInteger.prototype.intValue=bnIntValue,BigInteger.prototype.byteValue=bnByteValue,BigInteger.prototype.shortValue=bnShortValue,BigInteger.prototype.signum=bnSigNum,BigInteger.prototype.toByteArray=bnToByteArray,BigInteger.prototype.equals=bnEquals,BigInteger.prototype.min=bnMin,BigInteger.prototype.max=bnMax,BigInteger.prototype.and=bnAnd,BigInteger.prototype.or=bnOr,BigInteger.prototype.xor=bnXor,BigInteger.prototype.andNot=bnAndNot,BigInteger.prototype.not=bnNot,BigInteger.prototype.shiftLeft=bnShiftLeft,BigInteger.prototype.shiftRight=bnShiftRight,BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit,BigInteger.prototype.bitCount=bnBitCount,BigInteger.prototype.testBit=bnTestBit,BigInteger.prototype.setBit=bnSetBit,BigInteger.prototype.clearBit=bnClearBit,BigInteger.prototype.flipBit=bnFlipBit,BigInteger.prototype.add=bnAdd,BigInteger.prototype.subtract=bnSubtract,BigInteger.prototype.multiply=bnMultiply,BigInteger.prototype.divide=bnDivide,BigInteger.prototype.remainder=bnRemainder,BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder,BigInteger.prototype.modPow=bnModPow,BigInteger.prototype.modInverse=bnModInverse,BigInteger.prototype.pow=bnPow,BigInteger.prototype.gcd=bnGCD,BigInteger.prototype.isProbablePrime=bnIsProbablePrime,BigInteger.prototype.square=bnSquare;
function ECFieldElementFp(q,x){this.x=x,this.q=q}function feFpEquals(other){return other==this?!0:this.q.equals(other.q)&&this.x.equals(other.x)}function feFpToBigInteger(){return this.x}function feFpNegate(){return new ECFieldElementFp(this.q,this.x.negate().mod(this.q))}function feFpAdd(b){return new ECFieldElementFp(this.q,this.x.add(b.toBigInteger()).mod(this.q))}function feFpSubtract(b){return new ECFieldElementFp(this.q,this.x.subtract(b.toBigInteger()).mod(this.q))}function feFpMultiply(b){return new ECFieldElementFp(this.q,this.x.multiply(b.toBigInteger()).mod(this.q))}function feFpSquare(){return new ECFieldElementFp(this.q,this.x.square().mod(this.q))}function feFpDivide(b){return new ECFieldElementFp(this.q,this.x.multiply(b.toBigInteger().modInverse(this.q)).mod(this.q))}function ECPointFp(curve,x,y,z){this.curve=curve,this.x=x,this.y=y,z==null?this.z=BigInteger.ONE:this.z=z,this.zinv=null}function pointFpGetX(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function pointFpGetY(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function pointFpEquals(other){if(other==this)return!0;if(this.isInfinity())return other.isInfinity();if(other.isInfinity())return this.isInfinity();var u,v;return u=other.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(other.z)).mod(this.curve.q),u.equals(BigInteger.ZERO)?(v=other.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(other.z)).mod(this.curve.q),v.equals(BigInteger.ZERO)):!1}function pointFpIsInfinity(){return this.x==null&&this.y==null?!0:this.z.equals(BigInteger.ZERO)&&!this.y.toBigInteger().equals(BigInteger.ZERO)}function pointFpNegate(){return new ECPointFp(this.curve,this.x,this.y.negate(),this.z)}function pointFpAdd(b){if(this.isInfinity())return b;if(b.isInfinity())return this;var u=b.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(b.z)).mod(this.curve.q),v=b.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(b.z)).mod(this.curve.q);if(BigInteger.ZERO.equals(v))return BigInteger.ZERO.equals(u)?this.twice():this.curve.getInfinity();var THREE=new BigInteger("3"),x1=this.x.toBigInteger(),y1=this.y.toBigInteger(),x2=b.x.toBigInteger(),y2=b.y.toBigInteger(),v2=v.square(),v3=v2.multiply(v),x1v2=x1.multiply(v2),zu2=u.square().multiply(this.z),x3=zu2.subtract(x1v2.shiftLeft(1)).multiply(b.z).subtract(v3).multiply(v).mod(this.curve.q),y3=x1v2.multiply(THREE).multiply(u).subtract(y1.multiply(v3)).subtract(zu2.multiply(u)).multiply(b.z).add(u.multiply(v3)).mod(this.curve.q),z3=v3.multiply(this.z).multiply(b.z).mod(this.curve.q);return new ECPointFp(this.curve,this.curve.fromBigInteger(x3),this.curve.fromBigInteger(y3),z3)}function pointFpTwice(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var THREE=new BigInteger("3"),x1=this.x.toBigInteger(),y1=this.y.toBigInteger(),y1z1=y1.multiply(this.z),y1sqz1=y1z1.multiply(y1).mod(this.curve.q),a=this.curve.a.toBigInteger(),w=x1.square().multiply(THREE);BigInteger.ZERO.equals(a)||(w=w.add(this.z.square().multiply(a))),w=w.mod(this.curve.q);var x3=w.square().subtract(x1.shiftLeft(3).multiply(y1sqz1)).shiftLeft(1).multiply(y1z1).mod(this.curve.q),y3=w.multiply(THREE).multiply(x1).subtract(y1sqz1.shiftLeft(1)).shiftLeft(2).multiply(y1sqz1).subtract(w.square().multiply(w)).mod(this.curve.q),z3=y1z1.square().multiply(y1z1).shiftLeft(3).mod(this.curve.q);return new ECPointFp(this.curve,this.curve.fromBigInteger(x3),this.curve.fromBigInteger(y3),z3)}function pointFpMultiply(k){if(this.isInfinity())return this;if(k.signum()==0)return this.curve.getInfinity();var e=k,h=e.multiply(new BigInteger("3")),neg=this.negate(),R=this,i;for(i=h.bitLength()-2;i>0;--i){R=R.twice();var hBit=h.testBit(i),eBit=e.testBit(i);hBit!=eBit&&(R=R.add(hBit?this:neg))}return R}function pointFpMultiplyTwo(j,x,k){var i;j.bitLength()>k.bitLength()?i=j.bitLength()-1:i=k.bitLength()-1;var R=this.curve.getInfinity(),both=this.add(x);while(i>=0)R=R.twice(),j.testBit(i)?k.testBit(i)?R=R.add(both):R=R.add(this):k.testBit(i)&&(R=R.add(x)),--i;return R}function ECCurveFp(q,a,b){this.q=q,this.a=this.fromBigInteger(a),this.b=this.fromBigInteger(b),this.infinity=new ECPointFp(this,null,null)}function curveFpGetQ(){return this.q}function curveFpGetA(){return this.a}function curveFpGetB(){return this.b}function curveFpEquals(other){return other==this?!0:this.q.equals(other.q)&&this.a.equals(other.a)&&this.b.equals(other.b)}function curveFpGetInfinity(){return this.infinity}function curveFpFromBigInteger(x){return new ECFieldElementFp(this.q,x)}function curveFpDecodePointHex(s){switch(parseInt(s.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var len=(s.length-2)/2,xHex=s.substr(2,len),yHex=s.substr(len+2,len);return new ECPointFp(this,this.fromBigInteger(new BigInteger(xHex,16)),this.fromBigInteger(new BigInteger(yHex,16)));default:return null}}ECFieldElementFp.prototype.equals=feFpEquals,ECFieldElementFp.prototype.toBigInteger=feFpToBigInteger,ECFieldElementFp.prototype.negate=feFpNegate,ECFieldElementFp.prototype.add=feFpAdd,ECFieldElementFp.prototype.subtract=feFpSubtract,ECFieldElementFp.prototype.multiply=feFpMultiply,ECFieldElementFp.prototype.square=feFpSquare,ECFieldElementFp.prototype.divide=feFpDivide,ECPointFp.prototype.getX=pointFpGetX,ECPointFp.prototype.getY=pointFpGetY,ECPointFp.prototype.equals=pointFpEquals,ECPointFp.prototype.isInfinity=pointFpIsInfinity,ECPointFp.prototype.negate=pointFpNegate,ECPointFp.prototype.add=pointFpAdd,ECPointFp.prototype.twice=pointFpTwice,ECPointFp.prototype.multiply=pointFpMultiply,ECPointFp.prototype.multiplyTwo=pointFpMultiplyTwo,ECCurveFp.prototype.getQ=curveFpGetQ,ECCurveFp.prototype.getA=curveFpGetA,ECCurveFp.prototype.getB=curveFpGetB,ECCurveFp.prototype.equals=curveFpEquals,ECCurveFp.prototype.getInfinity=curveFpGetInfinity,ECCurveFp.prototype.fromBigInteger=curveFpFromBigInteger,ECCurveFp.prototype.decodePointHex=curveFpDecodePointHex;
function X9ECParameters(curve,g,n,h){this.curve=curve,this.g=g,this.n=n,this.h=h}function x9getCurve(){return this.curve}function x9getG(){return this.g}function x9getN(){return this.n}function x9getH(){return this.h}function fromHex(s){return new BigInteger(s,16)}function secp128r1(){var p=fromHex("FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF"),a=fromHex("FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC"),b=fromHex("E87579C11079F43DD824993C2CEE5ED3"),n=fromHex("FFFFFFFE0000000075A30D1B9038A115"),h=BigInteger.ONE,curve=new ECCurveFp(p,a,b),G=curve.decodePointHex("04161FF7528B899B2D0C28607CA52C5B86CF5AC8395BAFEB13C02DA292DDED7A83");return new X9ECParameters(curve,G,n,h)}function secp160k1(){var p=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73"),a=BigInteger.ZERO,b=fromHex("7"),n=fromHex("0100000000000000000001B8FA16DFAB9ACA16B6B3"),h=BigInteger.ONE,curve=new ECCurveFp(p,a,b),G=curve.decodePointHex("043B4C382CE37AA192A4019E763036F4F5DD4D7EBB938CF935318FDCED6BC28286531733C3F03C4FEE");return new X9ECParameters(curve,G,n,h)}function secp160r1(){var p=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF"),a=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC"),b=fromHex("1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45"),n=fromHex("0100000000000000000001F4C8F927AED3CA752257"),h=BigInteger.ONE,curve=new ECCurveFp(p,a,b),G=curve.decodePointHex("044A96B5688EF573284664698968C38BB913CBFC8223A628553168947D59DCC912042351377AC5FB32");return new X9ECParameters(curve,G,n,h)}function secp192k1(){var p=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37"),a=BigInteger.ZERO,b=fromHex("3"),n=fromHex("FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D"),h=BigInteger.ONE,curve=new ECCurveFp(p,a,b),G=curve.decodePointHex("04DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D");return new X9ECParameters(curve,G,n,h)}function secp192r1(){var p=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF"),a=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC"),b=fromHex("64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1"),n=fromHex("FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831"),h=BigInteger.ONE,curve=new ECCurveFp(p,a,b),G=curve.decodePointHex("04188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF101207192B95FFC8DA78631011ED6B24CDD573F977A11E794811");return new X9ECParameters(curve,G,n,h)}function secp224r1(){var p=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001"),a=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE"),b=fromHex("B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4"),n=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D"),h=BigInteger.ONE,curve=new ECCurveFp(p,a,b),G=curve.decodePointHex("04B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34");return new X9ECParameters(curve,G,n,h)}function secp256k1(){var p=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F"),a=BigInteger.ZERO,b=fromHex("7"),n=fromHex("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141"),h=BigInteger.ONE,curve=new ECCurveFp(p,a,b),G=curve.decodePointHex("0479BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8");return new X9ECParameters(curve,G,n,h)}function secp256r1(){var p=fromHex("FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF"),a=fromHex("FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC"),b=fromHex("5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B"),n=fromHex("FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551"),h=BigInteger.ONE,curve=new ECCurveFp(p,a,b),G=curve.decodePointHex("046B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C2964FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5");return new X9ECParameters(curve,G,n,h)}function getSECCurveByName(name){return name=="secp128r1"?secp128r1():name=="secp160k1"?secp160k1():name=="secp160r1"?secp160r1():name=="secp192k1"?secp192k1():name=="secp192r1"?secp192r1():name=="secp224r1"?secp224r1():name=="secp256k1"?secp256k1():name=="secp256r1"?secp256r1():null}X9ECParameters.prototype.getCurve=x9getCurve,X9ECParameters.prototype.getG=x9getG,X9ECParameters.prototype.getN=x9getN,X9ECParameters.prototype.getH=x9getH;
var EventEmitter=function(){};EventEmitter.prototype.on=function(name,callback,context){context||(context=this),this._listeners||(this._listeners={}),this._listeners[name]||(this._listeners[name]=[]),this._unbinders||(this._unbinders={}),this._unbinders[name]||(this._unbinders[name]=[]);var f=function(e){callback.apply(context,[e])};this._unbinders[name].push(callback),this._listeners[name].push(f)},EventEmitter.prototype.trigger=function(name,event){event===undefined&&(event={}),this._listeners||(this._listeners={});if(!this._listeners[name])return;var i=this._listeners[name].length;while(i--)this._listeners[name][i](event)},EventEmitter.prototype.removeListener=function(name,callback){this._unbinders||(this._unbinders={});if(!this._unbinders[name])return;var i=this._unbinders[name].length;while(i--)this._unbinders[name][i]===callback&&(this._unbinders[name].splice(i,1),this._listeners[name].splice(i,1))},EventEmitter.augment=function(obj){for(var method in EventEmitter.prototype)obj[method]||(obj[method]=EventEmitter.prototype[method])};
(function(exports){var Bitcoin=exports;"object"!=typeof module&&(Bitcoin.EventEmitter=EventEmitter)})("object"==typeof module?module.exports:window.Bitcoin={});
BigInteger.valueOf=nbv,BigInteger.prototype.toByteArrayUnsigned=function(){var ba=this.toByteArray();return ba.length?(ba[0]==0&&(ba=ba.slice(1)),ba.map(function(v){return v<0?v+256:v})):ba},BigInteger.fromByteArrayUnsigned=function(ba){return ba.length?ba[0]&128?new BigInteger([0].concat(ba)):new BigInteger(ba):ba.valueOf(0)};var names=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];"undefined"==typeof window.console&&(window.console={});for(var i=0;i<names.length;++i)"undefined"==typeof window.console[names[i]]&&(window.console[names[i]]=function(){});Bitcoin.Util={isArray:Array.isArray||function(o){return Object.prototype.toString.call(o)==="[object Array]"},makeFilledArray:function(len,val){var array=[],i=0;while(i<len)array[i++]=val;return array},numToVarInt:function(i){return i<253?[i]:i<=65536?[253,i>>>8,i&255]:i<=1?[254].concat(Crypto.util.wordsToBytes([i])):[255].concat(Crypto.util.wordsToBytes([i>>>32,i]))},valueToBigInt:function(valueBuffer){return valueBuffer instanceof BigInteger?valueBuffer:BigInteger.fromByteArrayUnsigned(valueBuffer)},formatValue:function(valueBuffer){var value=this.valueToBigInt(valueBuffer).toString(),integerPart=value.length>8?value.substr(0,value.length-8):"0",decimalPart=value.length>8?value.substr(value.length-8):value;while(decimalPart.length<8)decimalPart="0"+decimalPart;decimalPart=decimalPart.replace(/0*$/,"");while(decimalPart.length<2)decimalPart+="0";return integerPart+"."+decimalPart},parseValue:function(valueString){var valueComp=valueString.split("."),integralPart=valueComp[0],fractionalPart=valueComp[1]||"0";while(fractionalPart.length<8)fractionalPart+="0";fractionalPart=fractionalPart.replace(/^0+/g,"");var value=BigInteger.valueOf(parseInt(integralPart));return value=value.multiply(BigInteger.valueOf(1e8)),value=value.add(BigInteger.valueOf(parseInt(fractionalPart))),value},sha256ripe160:function(data){return Crypto.RIPEMD160(Crypto.SHA256(data,{asBytes:!0}),{asBytes:!0})}};for(var i in Crypto.util)Crypto.util.hasOwnProperty(i)&&(Bitcoin.Util[i]=Crypto.util[i]);
(function(Bitcoin){Bitcoin.Base58={alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",base:BigInteger.valueOf(58),encode:function(input){var bi=BigInteger.fromByteArrayUnsigned(input),chars=[];while(bi.compareTo(B58.base)>=0){var mod=bi.mod(B58.base);chars.unshift(B58.alphabet[mod.intValue()]),bi=bi.subtract(mod).divide(B58.base)}chars.unshift(B58.alphabet[bi.intValue()]);for(var i=0;i<input.length;i++){if(input[i]!=0)break;chars.unshift(B58.alphabet[0])}return chars.join("")},decode:function(input){var bi=BigInteger.valueOf(0),leadingZerosNum=0;for(var i=input.length-1;i>=0;i--){var alphaIndex=B58.alphabet.indexOf(input[i]);bi=bi.add(BigInteger.valueOf(alphaIndex).multiply(B58.base.pow(input.length-1-i))),input[i]=="1"?leadingZerosNum++:leadingZerosNum=0}var bytes=bi.toByteArrayUnsigned();while(leadingZerosNum-->0)bytes.unshift(0);return bytes}};var B58=Bitcoin.Base58})("undefined"!=typeof Bitcoin?Bitcoin:module.exports);
Bitcoin.Address=function(bytes){"string"==typeof bytes&&(bytes=Bitcoin.Address.decodeString(bytes)),this.hash=bytes,this.version=0},Bitcoin.Address.prototype.toString=function(){var hash=this.hash.slice(0);hash.unshift(this.version);var checksum=Crypto.SHA256(Crypto.SHA256(hash,{asBytes:!0}),{asBytes:!0}),bytes=hash.concat(checksum.slice(0,4));return Bitcoin.Base58.encode(bytes)},Bitcoin.Address.prototype.getHashBase64=function(){return Crypto.util.bytesToBase64(this.hash)},Bitcoin.Address.decodeString=function(string){var bytes=Bitcoin.Base58.decode(string),hash=bytes.slice(0,21),checksum=Crypto.SHA256(Crypto.SHA256(hash,{asBytes:!0}),{asBytes:!0});if(checksum[0]!=bytes[21]||checksum[1]!=bytes[22]||checksum[2]!=bytes[23]||checksum[3]!=bytes[24])throw"Checksum validation failed!";var version=hash.shift();if(version!=0)throw"Version "+version+" not supported!";return hash};
function integerToBytes(i,len){var bytes=i.toByteArrayUnsigned();if(len<bytes.length)bytes=bytes.slice(bytes.length-len);else while(len>bytes.length)bytes.unshift(0);return bytes}function dmp(v){return v instanceof BigInteger||(v=v.toBigInteger()),Crypto.util.bytesToHex(v.toByteArrayUnsigned())}ECFieldElementFp.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},ECPointFp.prototype.getEncoded=function(compressed){var x=this.getX().toBigInteger(),y=this.getY().toBigInteger(),enc=integerToBytes(x,32);return compressed?y.isEven()?enc.unshift(2):enc.unshift(3):(enc.unshift(4),enc=enc.concat(integerToBytes(y,32))),enc},ECPointFp.decodeFrom=function(curve,enc){var type=enc[0],dataLen=enc.length-1,xBa=enc.slice(1,1+dataLen/2),yBa=enc.slice(1+dataLen/2,1+dataLen);xBa.unshift(0),yBa.unshift(0);var x=new BigInteger(xBa),y=new BigInteger(yBa);return new ECPointFp(curve,curve.fromBigInteger(x),curve.fromBigInteger(y))},ECPointFp.prototype.add2D=function(b){if(this.isInfinity())return b;if(b.isInfinity())return this;if(this.x.equals(b.x))return this.y.equals(b.y)?this.twice():this.curve.getInfinity();var x_x=b.x.subtract(this.x),y_y=b.y.subtract(this.y),gamma=y_y.divide(x_x),x3=gamma.square().subtract(this.x).subtract(b.x),y3=gamma.multiply(this.x.subtract(x3)).subtract(this.y);return new ECPointFp(this.curve,x3,y3)},ECPointFp.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var TWO=this.curve.fromBigInteger(BigInteger.valueOf(2)),THREE=this.curve.fromBigInteger(BigInteger.valueOf(3)),gamma=this.x.square().multiply(THREE).add(this.curve.a).divide(this.y.multiply(TWO)),x3=gamma.square().subtract(this.x.multiply(TWO)),y3=gamma.multiply(this.x.subtract(x3)).subtract(this.y);return new ECPointFp(this.curve,x3,y3)},ECPointFp.prototype.multiply2D=function(k){if(this.isInfinity())return this;if(k.signum()==0)return this.curve.getInfinity();var e=k,h=e.multiply(new BigInteger("3")),neg=this.negate(),R=this,i;for(i=h.bitLength()-2;i>0;--i){R=R.twice();var hBit=h.testBit(i),eBit=e.testBit(i);hBit!=eBit&&(R=R.add2D(hBit?this:neg))}return R},ECPointFp.prototype.isOnCurve=function(){var x=this.getX().toBigInteger(),y=this.getY().toBigInteger(),a=this.curve.getA().toBigInteger(),b=this.curve.getB().toBigInteger(),n=this.curve.getQ(),lhs=y.multiply(y).mod(n),rhs=x.multiply(x).multiply(x).add(a.multiply(x)).add(b).mod(n);return lhs.equals(rhs)},ECPointFp.prototype.validate=function(){var n=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var x=this.getX().toBigInteger(),y=this.getY().toBigInteger();if(x.compareTo(BigInteger.ONE)<0||x.compareTo(n.subtract(BigInteger.ONE))>0)throw new Error("x coordinate out of bounds");if(y.compareTo(BigInteger.ONE)<0||y.compareTo(n.subtract(BigInteger.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(n).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0},Bitcoin.ECDSA=function(){function implShamirsTrick(P,k,Q,l){var m=Math.max(k.bitLength(),l.bitLength()),Z=P.add2D(Q),R=P.curve.getInfinity();for(var i=m-1;i>=0;--i)R=R.twice2D(),R.z=BigInteger.ONE,k.testBit(i)?l.testBit(i)?R=R.add2D(Z):R=R.add2D(P):l.testBit(i)&&(R=R.add2D(Q));return R}var ecparams=getSECCurveByName("secp256k1"),rng=new SecureRandom,ECDSA={getBigRandom:function(limit){return(new BigInteger(limit.bitLength(),rng)).mod(limit.subtract(BigInteger.ONE)).add(BigInteger.ONE)},sign:function(hash,priv){var d=priv,n=ecparams.getN(),e=BigInteger.fromByteArrayUnsigned(hash);do var k=ECDSA.getBigRandom(n),G=ecparams.getG(),Q=G.multiply(k),r=Q.getX().toBigInteger().mod(n);while(r.compareTo(BigInteger.ZERO)<=0);var s=k.modInverse(n).multiply(e.add(d.multiply(r))).mod(n);return ECDSA.serializeSig(r,s)},verify:function(hash,sig,pubkey){var obj=ECDSA.parseSig(sig),r=obj.r,s=obj.s,n=ecparams.getN(),e=BigInteger.fromByteArrayUnsigned(hash);if(r.compareTo(BigInteger.ONE)<0||r.compareTo(n)>=0)return!1;if(s.compareTo(BigInteger.ONE)<0||s.compareTo(n)>=0)return!1;var c=s.modInverse(n),u1=e.multiply(c).mod(n),u2=r.multiply(c).mod(n),G=ecparams.getG(),Q=ECPointFp.decodeFrom(ecparams.getCurve(),pubkey),point=implShamirsTrick(G,u1,Q,u2),v=point.x.toBigInteger().mod(n);return v.equals(r)},serializeSig:function(r,s){var rBa=r.toByteArrayUnsigned(),sBa=s.toByteArrayUnsigned(),sequence=[];return sequence.push(2),sequence.push(rBa.length),sequence=sequence.concat(rBa),sequence.push(2),sequence.push(sBa.length),sequence=sequence.concat(sBa),sequence.unshift(sequence.length),sequence.unshift(48),sequence},parseSig:function(sig){var cursor;if(sig[0]!=48)throw new Error("Signature not a valid DERSequence");cursor=2;if(sig[cursor]!=2)throw new Error("First element in signature must be a DERInteger");var rBa=sig.slice(cursor+2,cursor+2+sig[cursor+1]);cursor+=2+sig[cursor+1];if(sig[cursor]!=2)throw new Error("Second element in signature must be a DERInteger");var sBa=sig.slice(cursor+2,cursor+2+sig[cursor+1]);cursor+=2+sig[cursor+1];var r=BigInteger.fromByteArrayUnsigned(rBa),s=BigInteger.fromByteArrayUnsigned(sBa);return{r:r,s:s}}};return ECDSA}();
Bitcoin.ECKey=function(){var ECDSA=Bitcoin.ECDSA,ecparams=getSECCurveByName("secp256k1"),rng=new SecureRandom,ECKey=function(input){if(!input){var n=ecparams.getN();this.priv=ECDSA.getBigRandom(n)}else input instanceof BigInteger?this.priv=input:Bitcoin.Util.isArray(input)?this.priv=BigInteger.fromByteArrayUnsigned(input):"string"==typeof input&&(this.priv=BigInteger.fromByteArrayUnsigned(Crypto.util.base64ToBytes(input)))};return ECKey.prototype.getPub=function(){return this.pub?this.pub:this.pub=ecparams.getG().multiply(this.priv).getEncoded()},ECKey.prototype.getPubKeyHash=function(){return this.pubKeyHash?this.pubKeyHash:this.pubKeyHash=Bitcoin.Util.sha256ripe160(this.getPub())},ECKey.prototype.getBitcoinAddress=function(){var hash=this.getPubKeyHash(),addr=new Bitcoin.Address(hash);return addr},ECKey.prototype.setPub=function(pub){this.pub=pub},ECKey.prototype.toString=function(format){return format==="base64"?Crypto.util.bytesToBase64(this.priv.toByteArrayUnsigned()):Crypto.util.bytesToHex(this.priv.toByteArrayUnsigned())},ECKey.prototype.sign=function(hash){return ECDSA.sign(hash,this.priv)},ECKey.prototype.verify=function(hash,sig){return ECDSA.verify(hash,sig,this.getPub())},ECKey}();
(function(){var Opcode=Bitcoin.Opcode=function(num){this.code=num};Opcode.prototype.toString=function(){return Opcode.reverseMap[this.code]},Opcode.map={OP_0:0,OP_FALSE:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_1:81,OP_TRUE:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_LEFT:128,OP_RIGHT:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_NOP3:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255},Opcode.reverseMap=[];for(var i in Opcode.map)Opcode.reverseMap[Opcode.map[i]]=i})();
(function(){var Opcode=Bitcoin.Opcode,op=Opcode.map,Script=Bitcoin.Script=function(data){if(!data)this.buffer=[];else if("string"==typeof data)this.buffer=Crypto.util.base64ToBytes(data);else if(Bitcoin.Util.isArray(data))this.buffer=data;else{if(!(data instanceof Script))throw new Error("Invalid script");this.buffer=data.buffer}this.parse()};Script.prototype.parse=function(){function readChunk(n){self.chunks.push(self.buffer.slice(i,i+n)),i+=n}var self=this;this.chunks=[];var i=0;while(i<this.buffer.length){var opcode=this.buffer[i++];opcode>=240&&(opcode=opcode<<8|this.buffer[i++]);var len;opcode>0&&opcode<op.OP_PUSHDATA1?readChunk(opcode):opcode==op.OP_PUSHDATA1?(len=this.buffer[i++],readChunk(len)):opcode==op.OP_PUSHDATA2?(len=this.buffer[i++]<<8|this.buffer[i++],readChunk(len)):opcode==op.OP_PUSHDATA4?(len=this.buffer[i++]<<24|this.buffer[i++]<<16|this.buffer[i++]<<8|this.buffer[i++],readChunk(len)):this.chunks.push(opcode)}},Script.prototype.getOutType=function(){return this.chunks[this.chunks.length-1]==op.OP_CHECKMULTISIG&&this.chunks[this.chunks.length-2]<=3?"Multisig":this.chunks.length==5&&this.chunks[0]==op.OP_DUP&&this.chunks[1]==op.OP_HASH160&&this.chunks[3]==op.OP_EQUALVERIFY&&this.chunks[4]==op.OP_CHECKSIG?"Address":this.chunks.length==2&&this.chunks[1]==op.OP_CHECKSIG?"Pubkey":"Strange"},Script.prototype.simpleOutHash=function(){switch(this.getOutType()){case"Address":return this.chunks[2];case"Pubkey":return Bitcoin.Util.sha256ripe160(this.chunks[0]);default:throw new Error("Encountered non-standard scriptPubKey")}},Script.prototype.simpleOutPubKeyHash=Script.prototype.simpleOutHash,Script.prototype.getInType=function(){return this.chunks.length==1&&Bitcoin.Util.isArray(this.chunks[0])?"Pubkey":this.chunks.length==2&&Bitcoin.Util.isArray(this.chunks[0])&&Bitcoin.Util.isArray(this.chunks[1])?"Address":"Strange"},Script.prototype.simpleInPubKey=function(){switch(this.getInType()){case"Address":return this.chunks[1];case"Pubkey":throw new Error("Script does not contain pubkey.");default:throw new Error("Encountered non-standard scriptSig")}},Script.prototype.simpleInHash=function(){return Bitcoin.Util.sha256ripe160(this.simpleInPubKey())},Script.prototype.simpleInPubKeyHash=Script.prototype.simpleInHash,Script.prototype.writeOp=function(opcode){this.buffer.push(opcode),this.chunks.push(opcode)},Script.prototype.writeBytes=function(data){data.length<op.OP_PUSHDATA1?this.buffer.push(data.length):data.length<=255?(this.buffer.push(op.OP_PUSHDATA1),this.buffer.push(data.length)):data.length<=65535?(this.buffer.push(op.OP_PUSHDATA2),this.buffer.push(data.length&255),this.buffer.push(data.length>>>8&255)):(this.buffer.push(op.OP_PUSHDATA4),this.buffer.push(data.length&255),this.buffer.push(data.length>>>8&255),this.buffer.push(data.length>>>16&255),this.buffer.push(data.length>>>24&255)),this.buffer=this.buffer.concat(data),this.chunks.push(data)},Script.createOutputScript=function(address){var script=new Script;return script.writeOp(op.OP_DUP),script.writeOp(op.OP_HASH160),script.writeBytes(address.hash),script.writeOp(op.OP_EQUALVERIFY),script.writeOp(op.OP_CHECKSIG),script},Script.prototype.extractAddresses=function(addresses){switch(this.getOutType()){case"Address":return addresses.push(new Address(this.chunks[2])),1;case"Pubkey":return addresses.push(new Address(Util.sha256ripe160(this.chunks[0]))),1;case"Multisig":for(var i=1;i<this.chunks.length-2;++i)addresses.push(new Address(Util.sha256ripe160(this.chunks[i])));return this.chunks[0]-op.OP_1+1;default:throw new Error("Encountered non-standard scriptPubKey")}},Script.createMultiSigOutputScript=function(m,pubkeys){var script=new Bitcoin.Script;script.writeOp(op.OP_1+m-1);for(var i=0;i<pubkeys.length;++i)script.writeBytes(pubkeys[i]);return script.writeOp(op.OP_1+pubkeys.length-1),script.writeOp(op.OP_CHECKMULTISIG),script},Script.createInputScript=function(signature,pubKey){var script=new Script;return script.writeBytes(signature),script.writeBytes(pubKey),script},Script.prototype.clone=function(){return new Script(this.buffer)}})();
(function(){var Script=Bitcoin.Script,Transaction=Bitcoin.Transaction=function(doc){this.version=1,this.lock_time=0,this.ins=[],this.outs=[],this.timestamp=null,this.block=null;if(doc){doc.hash&&(this.hash=doc.hash),doc.version&&(this.version=doc.version),doc.lock_time&&(this.lock_time=doc.lock_time);if(doc.ins&&doc.ins.length)for(var i=0;i<doc.ins.length;i++)this.addInput(new TransactionIn(doc.ins[i]));if(doc.outs&&doc.outs.length)for(var i=0;i<doc.outs.length;i++)this.addOutput(new TransactionOut(doc.outs[i]));doc.timestamp&&(this.timestamp=doc.timestamp),doc.block&&(this.block=doc.block)}};Transaction.objectify=function(txs){var objs=[];for(var i=0;i<txs.length;i++)objs.push(new Transaction(txs[i]));return objs},Transaction.prototype.addInput=function(tx,outIndex){arguments[0]instanceof TransactionIn?this.ins.push(arguments[0]):this.ins.push(new TransactionIn({outpoint:{hash:tx.hash,index:outIndex},script:new Bitcoin.Script,sequence:4294967295}))},Transaction.prototype.addOutput=function(address,value){if(arguments[0]instanceof TransactionOut)this.outs.push(arguments[0]);else{if(value instanceof BigInteger){value=value.toByteArrayUnsigned().reverse();while(value.length<8)value.push(0)}else!Bitcoin.Util.isArray(value);this.outs.push(new TransactionOut({value:value,script:Script.createOutputScript(address)}))}},Transaction.prototype.serialize=function(){var buffer=[];buffer=buffer.concat(Crypto.util.wordsToBytes([parseInt(this.version)]).reverse()),buffer=buffer.concat(Bitcoin.Util.numToVarInt(this.ins.length));for(var i=0;i<this.ins.length;i++){var txin=this.ins[i];buffer=buffer.concat(Crypto.util.base64ToBytes(txin.outpoint.hash)),buffer=buffer.concat(Crypto.util.wordsToBytes([parseInt(txin.outpoint.index)]).reverse());var scriptBytes=txin.script.buffer;buffer=buffer.concat(Bitcoin.Util.numToVarInt(scriptBytes.length)),buffer=buffer.concat(scriptBytes),buffer=buffer.concat(Crypto.util.wordsToBytes([parseInt(txin.sequence)]).reverse())}buffer=buffer.concat(Bitcoin.Util.numToVarInt(this.outs.length));for(var i=0;i<this.outs.length;i++){var txout=this.outs[i];buffer=buffer.concat(txout.value);var scriptBytes=txout.script.buffer;buffer=buffer.concat(Bitcoin.Util.numToVarInt(scriptBytes.length)),buffer=buffer.concat(scriptBytes)}return buffer=buffer.concat(Crypto.util.wordsToBytes([parseInt(this.lock_time)]).reverse()),buffer},Transaction.from_serlized_hex=function(str){function spliceVarInt(buf){if(buf[0]<253)return buf.splice(0,1)[0];throw"big varints not supported"}var tx=new Transaction;buf=Crypto.util.hexToBytes("01000000028bc50187152a0c18f85bc7761d05e02c197fa9647be7cd48c86e234e4d36f8cd010000008a4730440220a400d3c6566d9d9f4a64c595b759b87836efe28a79e0e6612f41796cf5eae8280220b4a98420c06b00319971fa9a003fa1832f127d23a231bcde0aabee94cd35cffe01410483cef22b9ba7ec81907781fedf7933032259d2cd4c4240056cfc00ef7b20aa94a61328ce3ae87491b057cae1e26800e7ddda862c6e16f583726efe929ab0c180ffffffff9535a2e982c4233879caf1c913abef41fec61b19681ea9ca15e630e907f8fb33010000008a473044022040dd5ab4281f7d310f18b8dc098c14237435349725534681696fb2248e48366802203bb0b457139116adebf816a397b6ad4791946a820a12a4181adb62414853ba31014104588733f009e2700cdd71c39e19d962052398090f8c8c1a81455500f9cd093984fe4032c53f9addd67bb35d6acedc92228dd5b7ff4a7e87444122a30395877f93ffffffff0200e1f505000000001976a914455f971ec6cf93c3f0e27d36071b54450b83dd9588ac001a3704000000001976a914bf24cf8124792498778634e69cac57d5caccbbaa88ac00000000"),tx.version=Crypto.util.bytesToWords(buf.splice(0,4).reverse())[0],tx.ins=[];for(i=spliceVarInt(buf);i>0;i--){var txin={};txin.outpoint={},txin.outpoint.hash=Crypto.util.bytesToBase64(buf.splice(0,32)),txin.outpoint.index=Crypto.util.bytesToWords(buf.splice(0,4).reverse())[0],txin.script=new Bitcoin.Script(buf.splice(0,spliceVarInt(buf))),txin.sequence=Crypto.util.bytesToWords(buf.splice(0,4).reverse())[0],tx.ins.push(new Bitcoin.TransactionIn(txin))}this.outs=[];for(i=spliceVarInt(buf);i>0;i--){var txout={};txout.value=buf.splice(0,8),txout.script=new Bitcoin.Script(buf.splice(0,spliceVarInt(buf))),tx.outs.push(new Bitcoin.TransactionOut(txout))}tx.lock_time=Crypto.util.bytesToWords(buf.splice(0,4).reverse())[0]};var OP_CODESEPARATOR=171,SIGHASH_ALL=1,SIGHASH_NONE=2,SIGHASH_SINGLE=3,SIGHASH_ANYONECANPAY=80;Transaction.prototype.hashTransactionForSignature=function(connectedScript,inIndex,hashType){var txTmp=this.clone();for(var i=0;i<txTmp.ins.length;i++)txTmp.ins[i].script=new Script;txTmp.ins[inIndex].script=connectedScript;if((hashType&31)==SIGHASH_NONE){txTmp.outs=[];for(var i=0;i<txTmp.ins.length;i++)i!=inIndex&&(txTmp.ins[i].sequence=0)}else(hashType&31)!=SIGHASH_SINGLE;hashType&SIGHASH_ANYONECANPAY&&(txTmp.ins=[txTmp.ins[inIndex]]);var buffer=txTmp.serialize();buffer=buffer.concat(Crypto.util.wordsToBytes([parseInt(hashType)]).reverse());var hash1=Crypto.SHA256(buffer,{asBytes:!0});return Crypto.SHA256(hash1,{asBytes:!0})},Transaction.prototype.getHash=function(){var buffer=this.serialize();return Crypto.SHA256(Crypto.SHA256(buffer,{asBytes:!0}),{asBytes:!0})},Transaction.prototype.clone=function(){var newTx=new Transaction;newTx.version=this.version,newTx.lock_time=this.lock_time;for(var i=0;i<this.ins.length;i++){var txin=this.ins[i].clone();newTx.addInput(txin)}for(var i=0;i<this.outs.length;i++){var txout=this.outs[i].clone();newTx.addOutput(txout)}return newTx},Transaction.prototype.analyze=function(wallet){if(wallet instanceof Bitcoin.Wallet){var allFromMe=!0,allToMe=!0,firstRecvHash=null,firstMeRecvHash=null,firstSendHash=null;for(var i=this.outs.length-1;i>=0;i--){var txout=this.outs[i],hash=txout.script.simpleOutPubKeyHash();wallet.hasHash(hash)?firstMeRecvHash=hash:allToMe=!1,firstRecvHash=hash}for(var i=this.ins.length-1;i>=0;i--){var txin=this.ins[i];firstSendHash=txin.script.simpleInPubKeyHash();if(!wallet.hasHash(firstSendHash)){allFromMe=!1;break}}var impact=this.calcImpact(wallet),analysis={};return analysis.impact=impact,impact.sign>0&&impact.value.compareTo(BigInteger.ZERO)>0?(analysis.type="recv",analysis.addr=new Bitcoin.Address(firstMeRecvHash)):allFromMe&&allToMe?analysis.type="self":allFromMe?(analysis.type="sent",analysis.addr=new Bitcoin.Address(firstRecvHash)):analysis.type="other",analysis}return null},Transaction.prototype.getDescription=function(wallet){var analysis=this.analyze(wallet);if(!analysis)return"";switch(analysis.type){case"recv":return"Received with "+analysis.addr;case"sent":return"Payment to "+analysis.addr;case"self":return"Payment to yourself";case"other":default:return""}},Transaction.prototype.getTotalOutValue=function(){var totalValue=BigInteger.ZERO;for(var j=0;j<this.outs.length;j++){var txout=this.outs[j];totalValue=totalValue.add(Bitcoin.Util.valueToBigInt(txout.value))}return totalValue},Transaction.prototype.getTotalValue=Transaction.prototype.getTotalOutValue,Transaction.prototype.calcImpact=function(wallet){if(wallet instanceof Bitcoin.Wallet){var valueOut=BigInteger.ZERO;for(var j=0;j<this.outs.length;j++){var txout=this.outs[j],hash=Crypto.util.bytesToBase64(txout.script.simpleOutPubKeyHash());wallet.hasHash(hash)&&(valueOut=valueOut.add(Bitcoin.Util.valueToBigInt(txout.value)))}var valueIn=BigInteger.ZERO;for(var j=0;j<this.ins.length;j++){var txin=this.ins[j],hash=Crypto.util.bytesToBase64(txin.script.simpleInPubKeyHash());if(wallet.hasHash(hash)){var fromTx=wallet.txIndex[txin.outpoint.hash];fromTx&&(valueIn=valueIn.add(Bitcoin.Util.valueToBigInt(fromTx.outs[txin.outpoint.index].value)))}}return valueOut.compareTo(valueIn)>=0?{sign:1,value:valueOut.subtract(valueIn)}:{sign:-1,value:valueIn.subtract(valueOut)}}return BigInteger.ZERO};var TransactionIn=Bitcoin.TransactionIn=function(data){this.outpoint=data.outpoint,data.script instanceof Script?this.script=data.script:this.script=new Script(data.script),this.sequence=data.sequence};TransactionIn.prototype.clone=function(){var newTxin=new TransactionIn({outpoint:{hash:this.outpoint.hash,index:this.outpoint.index},script:this.script.clone(),sequence:this.sequence});return newTxin};var TransactionOut=Bitcoin.TransactionOut=function(data){data.script instanceof Script?this.script=data.script:this.script=new Script(data.script);if(Bitcoin.Util.isArray(data.value))this.value=data.value;else if("string"==typeof data.value){var valueHex=(new BigInteger(data.value,10)).toString(16);while(valueHex.length<16)valueHex="0"+valueHex;this.value=Crypto.util.hexToBytes(valueHex)}};TransactionOut.prototype.clone=function(){var newTxout=new TransactionOut({script:this.script.clone(),value:this.value.slice(0)});return newTxout}})();
Bitcoin.Wallet=function(){var Script=Bitcoin.Script,TransactionIn=Bitcoin.TransactionIn,TransactionOut=Bitcoin.TransactionOut,Wallet=function(){var keys=[];this.addressHashes=[],this.txIndex={},this.unspentOuts=[],this.addressPointer=0,this.addKey=function(key,pub){key instanceof Bitcoin.ECKey||(key=new Bitcoin.ECKey(key)),keys.push(key),pub&&("string"==typeof pub&&(pub=Crypto.util.base64ToBytes(pub)),key.pub=pub),this.addressHashes.push(key.getBitcoinAddress().getHashBase64())},this.addKeys=function(keys,pubs){"string"==typeof keys&&(keys=keys.split(",")),"string"==typeof pubs&&(pubs=pubs.split(","));var i;if(Array.isArray(pubs)&&keys.length==pubs.length)for(i=0;i<keys.length;i++)this.addKey(keys[i],pubs[i]);else for(i=0;i<keys.length;i++)this.addKey(keys[i])},this.getKeys=function(){var serializedWallet=[];for(var i=0;i<keys.length;i++)serializedWallet.push(keys[i].toString("base64"));return serializedWallet},this.getPubKeys=function(){var pubs=[];for(var i=0;i<keys.length;i++)pubs.push(Crypto.util.bytesToBase64(keys[i].getPub()));return pubs},this.clear=function(){keys=[]},this.getLength=function(){return keys.length},this.getAllAddresses=function(){var addresses=[];for(var i=0;i<keys.length;i++)addresses.push(keys[i].getBitcoinAddress());return addresses},this.getCurAddress=function(){return keys[this.addressPointer]?keys[this.addressPointer].getBitcoinAddress():null},this.getNextAddress=function(){return this.addressPointer++,keys[this.addressPointer]||this.generateAddress(),keys[this.addressPointer].getBitcoinAddress()},this.signWithKey=function(pubKeyHash,hash){pubKeyHash=Crypto.util.bytesToBase64(pubKeyHash);for(var i=0;i<this.addressHashes.length;i++)if(this.addressHashes[i]==pubKeyHash)return keys[i].sign(hash);throw new Error("Missing key for signature")},this.getPubKeyFromHash=function(pubKeyHash){pubKeyHash=Crypto.util.bytesToBase64(pubKeyHash);for(var i=0;i<this.addressHashes.length;i++)if(this.addressHashes[i]==pubKeyHash)return keys[i].getPub();throw new Error("Hash unknown")}};return Wallet.prototype.generateAddress=function(){this.addKey(new Bitcoin.ECKey)},Wallet.prototype.process=function(tx){if(this.txIndex[tx.hash])return;var j,k,hash;for(j=0;j<tx.outs.length;j++){var txout=new TransactionOut(tx.outs[j]);hash=Crypto.util.bytesToBase64(txout.script.simpleOutPubKeyHash());for(k=0;k<this.addressHashes.length;k++)if(this.addressHashes[k]===hash){this.unspentOuts.push({tx:tx,index:j,out:txout});break}}for(j=0;j<tx.ins.length;j++){var txin=new TransactionIn(tx.ins[j]),pubkey=txin.script.simpleInPubKey();hash=Crypto.util.bytesToBase64(Bitcoin.Util.sha256ripe160(pubkey));for(k=0;k<this.addressHashes.length;k++)if(this.addressHashes[k]===hash){for(var l=0;l<this.unspentOuts.length;l++)txin.outpoint.hash==this.unspentOuts[l].tx.hash&&txin.outpoint.index==this.unspentOuts[l].index&&this.unspentOuts.splice(l,1);break}}this.txIndex[tx.hash]=tx},Wallet.prototype.getBalance=function(){var balance=BigInteger.valueOf(0);for(var i=0;i<this.unspentOuts.length;i++){var txout=this.unspentOuts[i].out;balance=balance.add(Bitcoin.Util.valueToBigInt(txout.value))}return balance},Wallet.prototype.createSend=function(address,sendValue,feeValue){var selectedOuts=[],txValue=sendValue.add(feeValue),availableValue=BigInteger.ZERO,i;for(i=0;i<this.unspentOuts.length;i++){selectedOuts.push(this.unspentOuts[i]),availableValue=availableValue.add(Bitcoin.Util.valueToBigInt(this.unspentOuts[i].out.value));if(availableValue.compareTo(txValue)>=0)break}if(availableValue.compareTo(txValue)<0)throw new Error("Insufficient funds.");var changeValue=availableValue.subtract(txValue),sendTx=new Bitcoin.Transaction;for(i=0;i<selectedOuts.length;i++)sendTx.addInput(selectedOuts[i].tx,selectedOuts[i].index);sendTx.addOutput(address,sendValue),changeValue.compareTo(BigInteger.ZERO)>0&&sendTx.addOutput(this.getNextAddress(),changeValue);var hashType=1;for(i=0;i<sendTx.ins.length;i++){var hash=sendTx.hashTransactionForSignature(selectedOuts[i].out.script,i,hashType),pubKeyHash=selectedOuts[i].out.script.simpleOutPubKeyHash(),signature=this.signWithKey(pubKeyHash,hash);signature.push(parseInt(hashType,10)),sendTx.ins[i].script=Script.createInputScript(signature,this.getPubKeyFromHash(pubKeyHash))}return sendTx},Wallet.prototype.clearTransactions=function(){this.txIndex={},this.unspentOuts=[]},Wallet.prototype.hasHash=function(hash){Bitcoin.Util.isArray(hash)&&(hash=Crypto.util.bytesToBase64(hash));for(var k=0;k<this.addressHashes.length;k++)if(this.addressHashes[k]===hash)return!0;return!1},Wallet}();
var TransactionDatabase=function(){this.txs=[],this.txIndex={}};EventEmitter.augment(TransactionDatabase.prototype),TransactionDatabase.prototype.addTransaction=function(tx){this.addTransactionNoUpdate(tx),$(this).trigger("update")},TransactionDatabase.prototype.addTransactionNoUpdate=function(tx){if(this.txIndex[tx.hash])return;this.txs.push(new Bitcoin.Transaction(tx)),this.txIndex[tx.hash]=tx},TransactionDatabase.prototype.removeTransaction=function(hash){this.removeTransactionNoUpdate(hash),$(this).trigger("update")},TransactionDatabase.prototype.removeTransactionNoUpdate=function(hash){var tx=this.txIndex[hash];if(!tx)return;for(var i=0,l=this.txs.length;i<l;i++)if(this.txs[i].hash==hash){this.txs.splice(i,1);break}delete this.txIndex[hash]},TransactionDatabase.prototype.loadTransactions=function(txs){for(var i=0;i<txs.length;i++)this.addTransactionNoUpdate(txs[i]);$(this).trigger("update")},TransactionDatabase.prototype.getTransactions=function(){return this.txs},TransactionDatabase.prototype.clear=function(){this.txs=[],this.txIndex={},$(this).trigger("update")}
